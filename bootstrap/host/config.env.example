# Target host (Ubuntu 24.04)
TARGET_HOST=""
TARGET_PORT="22"
TARGET_ROOT_USER="root"
TARGET_ROOT_SSH_KEY="${HOME}/.ssh/id_rsa"

# New operator user created on target host
OPERATOR_USER="codex"
OPERATOR_SSH_PUBKEY_PATH="${HOME}/.ssh/id_rsa.pub"

# Platform repository with codex-k8s source (owner/name).
# This repository stores platform CI variables/secrets during bootstrap.
CODEXK8S_GITHUB_REPO=""
# Optional first project repository (owner/name) for additional webhook + labels setup.
# Bootstrap always configures webhook + labels in CODEXK8S_GITHUB_REPO.
# If empty, only CODEXK8S_GITHUB_REPO is configured (dogfooding mode).
CODEXK8S_FIRST_PROJECT_GITHUB_REPO=""

# External credentials (optional in file; if empty script will ask interactively)
# Required: fine-grained GitHub token used by bootstrap/Kaniko and
# synced into control-plane runtime for repository/project management paths.
# Minimum permissions: repository contents (read), secrets (read/write), variables (read/write), administration (read/write for webhook/labels in platform repo and optional first project repo).
CODEXK8S_GITHUB_PAT=""
# OpenAI API key for codex-cli API-key auth (optional).
# If empty, Codex will use ChatGPT device auth on first agent run (instructions appear in run logs).
CODEXK8S_OPENAI_API_KEY=""
# Dedicated git transport token for agent-run pods.
CODEXK8S_GIT_BOT_TOKEN=""
CODEXK8S_GIT_BOT_USERNAME="codex-bot"
CODEXK8S_GIT_BOT_MAIL="codex-bot@codex-k8s.local"
# Project DB admin profile used by MCP `database.lifecycle`.
# If any value is empty, bootstrap derives defaults and stores them in GitHub/Kubernetes secrets:
# - HOST: postgres
# - PORT: 5432
# - USER/PASSWORD: CODEXK8S_POSTGRES_USER / CODEXK8S_POSTGRES_PASSWORD
# - SSLMODE: disable
# - DATABASE: postgres
CODEXK8S_PROJECT_DB_ADMIN_HOST=""
CODEXK8S_PROJECT_DB_ADMIN_PORT=""
CODEXK8S_PROJECT_DB_ADMIN_USER=""
CODEXK8S_PROJECT_DB_ADMIN_PASSWORD=""
CODEXK8S_PROJECT_DB_ADMIN_SSLMODE=""
CODEXK8S_PROJECT_DB_ADMIN_DATABASE=""
# Optional comma-separated allowlist for MCP `database.lifecycle` environment scoping.
# Empty value means app defaults are used (dev,production,prod).
CODEXK8S_PROJECT_DB_LIFECYCLE_ALLOWED_ENVS=""
CODEXK8S_CONTEXT7_API_KEY=""

# Environment-scoped overrides (optional).
#
# For AI slots the platform reads secrets from the "ai" environment:
# - GitHub environment: "ai"
# - Kubernetes shared secret: codex-k8s-runtime-ai (production namespace)
#
# Override rule:
# - Base key: CODEXK8S_<NAME>
# - AI override key: CODEXK8S_AI_<NAME>
# - Production override key: CODEXK8S_PRODUCTION_<NAME>
# - Дополнительный pattern режим: CODEXK8S_<NAME>_AI (см. spec.secretResolution в services.yaml).
#
# Example: to use a different OpenAI key in AI slots set CODEXK8S_AI_OPENAI_API_KEY.
CODEXK8S_AI_OPENAI_API_KEY=""
CODEXK8S_AI_CONTEXT7_API_KEY=""
CODEXK8S_AI_GITHUB_PAT=""
CODEXK8S_AI_GIT_BOT_TOKEN=""
CODEXK8S_GITHUB_OAUTH_CLIENT_ID_AI=""
CODEXK8S_GITHUB_OAUTH_CLIENT_SECRET_AI=""
CODEXK8S_PRODUCTION_GITHUB_OAUTH_CLIENT_ID=""
CODEXK8S_PRODUCTION_GITHUB_OAUTH_CLIENT_SECRET=""

# Staff auth (GitHub OAuth + short-lived JWT).
#
# 1) Create OAuth App at https://github.com/settings/applications/new
# 2) Set:
#    - Homepage URL: https://<CODEXK8S_PRODUCTION_DOMAIN>
#    - Authorization callback URL (shared oauth2-proxy): https://<CODEXK8S_PRODUCTION_DOMAIN>/oauth2/callback
# 3) Fill the Client ID/Secret here.
# Один OAuth App достаточно для production и AI-слотов:
# slot ingress использует centralized auth endpoint через nginx auth-url/auth-signin.
#
# Public base URL is used for OAuth redirect URL generation and must match your domain.
CODEXK8S_PUBLIC_BASE_URL="https://platform.codex-k8s.dev"
# Optional: centralized OAuth endpoints used by slot ingresses.
# Empty values are auto-derived from CODEXK8S_PRODUCTION_DOMAIN:
# - https://<CODEXK8S_PRODUCTION_DOMAIN>/oauth2/auth
# - https://<CODEXK8S_PRODUCTION_DOMAIN>/oauth2/start?rd=$scheme://$host$request_uri
CODEXK8S_SHARED_OAUTH2_PROXY_AUTH_URL=""
CODEXK8S_SHARED_OAUTH2_PROXY_SIGNIN_URL=""
# Optional: cookie domain for shared oauth2-proxy session.
# Empty value is auto-derived as ".<CODEXK8S_PRODUCTION_DOMAIN>".
CODEXK8S_OAUTH2_PROXY_COOKIE_DOMAIN=""
# Registration is disabled; first login is allowed only for pre-approved email.
# Owner email becomes a platform admin and can add other users later.
CODEXK8S_BOOTSTRAP_OWNER_EMAIL="owner@example.com"
# Optional: comma-separated list of additional staff emails to pre-provision into DB on startup.
# This avoids {"code":"forbidden","message":"email is not allowed"} on first login.
CODEXK8S_BOOTSTRAP_ALLOWED_EMAILS=""
# Optional: comma-separated list of additional platform admins (owners).
# These emails are created/updated in DB with is_platform_admin=true on startup.
CODEXK8S_BOOTSTRAP_PLATFORM_ADMIN_EMAILS=""
CODEXK8S_GITHUB_OAUTH_CLIENT_ID=""
CODEXK8S_GITHUB_OAUTH_CLIENT_SECRET=""
# Optional: if empty, bootstrap generates a random value.
CODEXK8S_JWT_SIGNING_KEY=""
CODEXK8S_MCP_TOKEN_SIGNING_KEY=""
# Short-lived JWT TTL (e.g. 15m, 30m). Stored in runtime secret as plain text.
CODEXK8S_JWT_TTL="15m"
CODEXK8S_MCP_TOKEN_TTL="24h"
CODEXK8S_RUN_AGENT_LOGS_RETENTION_DAYS="14"
# Optional: if empty, bootstrap generates a random value.
# Used for validating GitHub webhook signatures (X-Hub-Signature-256).
CODEXK8S_GITHUB_WEBHOOK_SECRET=""
# Optional override for repository webhook endpoint.
CODEXK8S_GITHUB_WEBHOOK_URL=""
# Comma-separated GitHub webhook events.
CODEXK8S_GITHUB_WEBHOOK_EVENTS="push,pull_request,issues,issue_comment,pull_request_review,pull_request_review_comment"

# Canonical label catalog (GitHub repository variables, labels-as-vars).
# Active in S3 Day1+: full run:* stage catalog + state:* + need:* labels.
CODEXK8S_RUN_INTAKE_LABEL="run:intake"
CODEXK8S_RUN_INTAKE_REVISE_LABEL="run:intake:revise"
CODEXK8S_RUN_VISION_LABEL="run:vision"
CODEXK8S_RUN_VISION_REVISE_LABEL="run:vision:revise"
CODEXK8S_RUN_PRD_LABEL="run:prd"
CODEXK8S_RUN_PRD_REVISE_LABEL="run:prd:revise"
CODEXK8S_RUN_ARCH_LABEL="run:arch"
CODEXK8S_RUN_ARCH_REVISE_LABEL="run:arch:revise"
CODEXK8S_RUN_DESIGN_LABEL="run:design"
CODEXK8S_RUN_DESIGN_REVISE_LABEL="run:design:revise"
CODEXK8S_RUN_PLAN_LABEL="run:plan"
CODEXK8S_RUN_PLAN_REVISE_LABEL="run:plan:revise"
CODEXK8S_RUN_DEV_LABEL="run:dev"
CODEXK8S_RUN_DEV_REVISE_LABEL="run:dev:revise"
CODEXK8S_RUN_DEBUG_LABEL="run:debug"
CODEXK8S_RUN_DOC_AUDIT_LABEL="run:doc-audit"
CODEXK8S_RUN_QA_LABEL="run:qa"
CODEXK8S_RUN_RELEASE_LABEL="run:release"
CODEXK8S_RUN_POSTDEPLOY_LABEL="run:postdeploy"
CODEXK8S_RUN_OPS_LABEL="run:ops"
CODEXK8S_RUN_SELF_IMPROVE_LABEL="run:self-improve"
CODEXK8S_RUN_RETHINK_LABEL="run:rethink"
CODEXK8S_MODE_DISCUSSION_LABEL="mode:discussion"
CODEXK8S_STATE_BLOCKED_LABEL="state:blocked"
CODEXK8S_STATE_IN_REVIEW_LABEL="state:in-review"
CODEXK8S_STATE_APPROVED_LABEL="state:approved"
CODEXK8S_STATE_SUPERSEDED_LABEL="state:superseded"
CODEXK8S_STATE_ABANDONED_LABEL="state:abandoned"
CODEXK8S_NEED_INPUT_LABEL="need:input"
CODEXK8S_NEED_PM_LABEL="need:pm"
CODEXK8S_NEED_SA_LABEL="need:sa"
CODEXK8S_NEED_QA_LABEL="need:qa"
CODEXK8S_NEED_SRE_LABEL="need:sre"
CODEXK8S_NEED_EM_LABEL="need:em"
CODEXK8S_NEED_KM_LABEL="need:km"
CODEXK8S_NEED_REVIEWER_LABEL="need:reviewer"

# Configuration labels (model/reasoning profile for run:dev and run:dev:revise).
CODEXK8S_AI_MODEL_GPT_5_3_CODEX_LABEL="[ai-model-gpt-5.3-codex]"
CODEXK8S_AI_MODEL_GPT_5_3_CODEX_SPARK_LABEL="[ai-model-gpt-5.3-codex-spark]"
CODEXK8S_AI_MODEL_GPT_5_2_CODEX_LABEL="[ai-model-gpt-5.2-codex]"
CODEXK8S_AI_MODEL_GPT_5_1_CODEX_MAX_LABEL="[ai-model-gpt-5.1-codex-max]"
CODEXK8S_AI_MODEL_GPT_5_2_LABEL="[ai-model-gpt-5.2]"
CODEXK8S_AI_MODEL_GPT_5_1_CODEX_MINI_LABEL="[ai-model-gpt-5.1-codex-mini]"
CODEXK8S_AI_REASONING_LOW_LABEL="[ai-reasoning-low]"
CODEXK8S_AI_REASONING_MEDIUM_LABEL="[ai-reasoning-medium]"
CODEXK8S_AI_REASONING_HIGH_LABEL="[ai-reasoning-high]"
CODEXK8S_AI_REASONING_EXTRA_HIGH_LABEL="[ai-reasoning-extra-high]"

# Production settings
CODEXK8S_PRODUCTION_NAMESPACE="codex-k8s-prod"
# Required: must resolve to TARGET_HOST before bootstrap starts.
CODEXK8S_PRODUCTION_DOMAIN="platform.codex-k8s.dev"
CODEXK8S_AI_DOMAIN="ai.platform.codex-k8s.dev"
# Required for Let's Encrypt account registration.
CODEXK8S_LETSENCRYPT_EMAIL="ops@example.com"
CODEXK8S_LETSENCRYPT_SERVER="https://acme-v02.api.letsencrypt.org/directory"

# Internal registry (no auth by design for MVP).
# Security model for production: registry listens on node loopback (127.0.0.1) only.
# This profile is intended for single-node production.
CODEXK8S_INTERNAL_REGISTRY_SERVICE="codex-k8s-registry"
CODEXK8S_INTERNAL_REGISTRY_PORT="5000"
CODEXK8S_INTERNAL_REGISTRY_STORAGE_SIZE="20Gi"
CODEXK8S_INTERNAL_REGISTRY_HOST="127.0.0.1:5000"
CODEXK8S_API_GATEWAY_INTERNAL_IMAGE_REPOSITORY="codex-k8s/api-gateway"
CODEXK8S_CONTROL_PLANE_INTERNAL_IMAGE_REPOSITORY="codex-k8s/control-plane"
CODEXK8S_WORKER_INTERNAL_IMAGE_REPOSITORY="codex-k8s/worker"
CODEXK8S_AGENT_RUNNER_INTERNAL_IMAGE_REPOSITORY="codex-k8s/agent-runner"
CODEXK8S_WEB_CONSOLE_INTERNAL_IMAGE_REPOSITORY="codex-k8s/web-console"
# Keep empty to let bootstrap autogenerate from CODEXK8S_INTERNAL_REGISTRY_HOST + per-service repositories.
CODEXK8S_API_GATEWAY_IMAGE=""
CODEXK8S_CONTROL_PLANE_IMAGE=""
CODEXK8S_WORKER_IMAGE=""
CODEXK8S_AGENT_RUNNER_IMAGE=""
CODEXK8S_WEB_CONSOLE_IMAGE=""
CODEXK8S_KANIKO_TIMEOUT="1800s"
CODEXK8S_KANIKO_CACHE_ENABLED="true"
# Optional: if empty, build script uses "${CODEXK8S_INTERNAL_REGISTRY_HOST}/codex-k8s/kaniko-cache".
CODEXK8S_KANIKO_CACHE_REPO=""
CODEXK8S_KANIKO_CACHE_TTL="168h"
CODEXK8S_KANIKO_CACHE_COMPRESSED="false"
CODEXK8S_KANIKO_CACHE_COPY_LAYERS="true"
CODEXK8S_KANIKO_SNAPSHOT_MODE="redo"
CODEXK8S_KANIKO_SINGLE_SNAPSHOT="true"
CODEXK8S_KANIKO_USE_NEW_RUN="true"
CODEXK8S_KANIKO_VERBOSITY="info"
CODEXK8S_KANIKO_CLEANUP="true"
CODEXK8S_KANIKO_CPU_REQUEST="4"
CODEXK8S_KANIKO_MEMORY_REQUEST="8Gi"
CODEXK8S_KANIKO_CPU_LIMIT="16"
CODEXK8S_KANIKO_MEMORY_LIMIT="32Gi"
CODEXK8S_KANIKO_MAX_PARALLEL="4"
CODEXK8S_IMAGE_MIRROR_ENABLED="true"
CODEXK8S_IMAGE_MIRROR_TOOL_IMAGE="gcr.io/go-containerregistry/crane:debug"
CODEXK8S_REGISTRY_CLEANUP_KEEP_TAGS="5"
CODEXK8S_KANIKO_CLONE_IMAGE=""
CODEXK8S_KANIKO_EXECUTOR_IMAGE=""
CODEXK8S_BUSYBOX_IMAGE=""
CODEXK8S_POSTGRES_IMAGE=""
CODEXK8S_OAUTH2_PROXY_IMAGE=""
CODEXK8S_REGISTRY_IMAGE=""
CODEXK8S_CODEGEN_CHECK_IMAGE=""
CODEXK8S_PLATFORM_DEPLOYMENT_REPLICAS="2"

# Worker defaults (run loop + slots + Kubernetes jobs).
CODEXK8S_WORKER_REPLICAS=""
CODEXK8S_WORKER_POLL_INTERVAL="5s"
CODEXK8S_WORKER_CLAIM_LIMIT="2"
CODEXK8S_WORKER_RUNNING_CHECK_LIMIT="200"
CODEXK8S_WORKER_SLOTS_PER_PROJECT="2"
CODEXK8S_WORKER_SLOT_LEASE_TTL="10m"
CODEXK8S_WORKER_K8S_NAMESPACE="codex-k8s-prod"
CODEXK8S_WORKER_JOB_IMAGE=""
CODEXK8S_WORKER_JOB_COMMAND="/usr/local/bin/codex-k8s-agent-runner"
CODEXK8S_WORKER_JOB_TTL_SECONDS="600"
CODEXK8S_WORKER_JOB_BACKOFF_LIMIT="0"
CODEXK8S_WORKER_JOB_ACTIVE_DEADLINE_SECONDS="900"
CODEXK8S_WORKER_RUN_NAMESPACE_PREFIX="codex-issue"
CODEXK8S_WORKER_RUN_NAMESPACE_CLEANUP="true"
CODEXK8S_WORKER_RUN_SERVICE_ACCOUNT="codex-runner"
CODEXK8S_WORKER_RUN_ROLE_NAME="codex-runner"
CODEXK8S_WORKER_RUN_ROLE_BINDING_NAME="codex-runner"
CODEXK8S_WORKER_RUN_RESOURCE_QUOTA_NAME="codex-run-quota"
CODEXK8S_WORKER_RUN_LIMIT_RANGE_NAME="codex-run-limits"
CODEXK8S_WORKER_RUN_CREDENTIALS_SECRET_NAME="codex-run-credentials"
CODEXK8S_WORKER_RUN_QUOTA_PODS="20"
# Default model policy:
# - gpt-5.2-codex by default.
# - if CODEXK8S_OPENAI_API_KEY is empty, agent runs will require Codex device auth.
CODEXK8S_AGENT_DEFAULT_MODEL="gpt-5.2-codex"
CODEXK8S_AGENT_DEFAULT_REASONING_EFFORT="xhigh"
CODEXK8S_AGENT_DEFAULT_LOCALE="ru"
CODEXK8S_AGENT_BASE_BRANCH="main"
CODEXK8S_CONTROL_PLANE_GRPC_TARGET="codex-k8s-control-plane.codex-k8s-prod.svc.cluster.local:9090"
CODEXK8S_CONTROL_PLANE_MCP_BASE_URL="http://codex-k8s-control-plane.codex-k8s-prod.svc.cluster.local:8081/mcp"

# Learning mode default for newly created projects.
# Keep "true" to enable educational explanations by default.
# Set empty value to disable by default.
CODEXK8S_LEARNING_MODE_DEFAULT="true"
CODEXK8S_WAIT_ROLLOUT="true"

# Timeouts and retries for slower servers/networks.
CODEXK8S_DNS_WAIT_TIMEOUT="900"
CODEXK8S_DNS_WAIT_INTERVAL="10"
CODEXK8S_NODE_DISCOVERY_TIMEOUT="300"
CODEXK8S_NODE_READY_TIMEOUT="1200s"
CODEXK8S_INGRESS_READY_TIMEOUT="1200s"
CODEXK8S_CERT_MANAGER_READY_TIMEOUT="1200s"
CODEXK8S_ROLLOUT_TIMEOUT="1800s"

# Optional storage profile for bootstrap.
# For production/single-node k3s, PVC works without Longhorn via the default local-path provisioner.
CODEXK8S_INSTALL_LONGHORN="false"
# For bare-metal/production without cloud LoadBalancer expose ingress directly on host :80/:443.
CODEXK8S_INGRESS_HOST_NETWORK="true"

# Host firewall hardening (recommended).
# When enabled, external inbound access is limited to CODEXK8S_SSH_PORT, 80 and 443.
CODEXK8S_FIREWALL_ENABLED="true"
# Keep equal to TARGET_PORT unless you intentionally expose SSH on another port.
CODEXK8S_SSH_PORT="22"

# NetworkPolicy baseline in Kubernetes (recommended).
# Labels platform/system namespaces and applies baseline restrictions for platform traffic.
CODEXK8S_NETWORK_POLICY_BASELINE="true"
# codex-k8s MCP HTTP port in platform namespace (used by project/agent policy template).
CODEXK8S_PLATFORM_MCP_PORT="8081"

# Allow egress to Kubernetes API server (k3s typically uses nodeIP:6443).
# For single-node production set CODEXK8S_K8S_API_CIDR to the node IP /32.
# If empty, bootstrap will default to TARGET_HOST/32.
CODEXK8S_K8S_API_CIDR=""
CODEXK8S_K8S_API_PORT="6443"
