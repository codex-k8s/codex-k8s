# Target host (Ubuntu 24.04)
TARGET_HOST=""
TARGET_PORT="22"
TARGET_ROOT_USER="root"
TARGET_ROOT_SSH_KEY="${HOME}/.ssh/id_rsa"

# New operator user created on target host
OPERATOR_USER="codex"
OPERATOR_SSH_PUBKEY_PATH="${HOME}/.ssh/id_rsa.pub"

# GitHub repository (owner/name)
CODEXK8S_GITHUB_REPO=""

# External credentials (optional in file; if empty script will ask interactively)
# Required: fine-grained GitHub token used by bootstrap/ARC/Kaniko and
# synced into control-plane runtime for repository/project management paths.
# Minimum permissions: repository contents (read), actions (read/write), secrets (read/write), variables (read/write), administration (read/write as needed).
CODEXK8S_GITHUB_PAT=""
# OpenAI API key for codex-cli API-key auth (works without ChatGPT subscription auth file).
CODEXK8S_OPENAI_API_KEY=""
# Optional auth payload for codex-cli ChatGPT-subscription auth.
# How to prepare:
# 1) On your local machine login once: `codex login` under your ChatGPT account.
# 2) Copy JSON from ~/.codex/auth.json and paste it as a single line here
#    (or set GitHub secret CODEXK8S_OPENAI_AUTH_FILE directly).
# 3) If this value is non-empty, runtime can use subscription-only models (e.g. gpt-5.3-codex).
# 4) If this value is empty, runtime falls back to gpt-5.2-codex where needed.
# Important: empty string means "do not overwrite existing GitHub secret" during bootstrap secret sync.
CODEXK8S_OPENAI_AUTH_FILE=''
# Dedicated git transport token for agent-run pods.
CODEXK8S_GIT_BOT_TOKEN=""
CODEXK8S_GIT_BOT_USERNAME="codex-bot"
CODEXK8S_GIT_BOT_MAIL="codex-bot@codex-k8s.local"
CODEXK8S_CONTEXT7_API_KEY=""

# Staff auth (GitHub OAuth + short-lived JWT).
#
# 1) Create OAuth App at https://github.com/settings/applications/new
# 2) Set:
#    - Homepage URL: https://<CODEXK8S_STAGING_DOMAIN>
#    - Authorization callback URL (dev/staging via oauth2-proxy): https://<CODEXK8S_STAGING_DOMAIN>/oauth2/callback
# 3) Fill the Client ID/Secret here.
#
# Public base URL is used for OAuth redirect URL generation and must match your domain.
CODEXK8S_PUBLIC_BASE_URL="https://staging.example.com"
# Registration is disabled; first login is allowed only for pre-approved email.
# Owner email becomes a platform admin and can add other users later.
CODEXK8S_BOOTSTRAP_OWNER_EMAIL="owner@example.com"
# Optional: comma-separated list of additional staff emails to pre-provision into DB on startup.
# This avoids {"code":"forbidden","message":"email is not allowed"} on first login.
CODEXK8S_BOOTSTRAP_ALLOWED_EMAILS=""
# Optional: comma-separated list of additional platform admins (owners).
# These emails are created/updated in DB with is_platform_admin=true on startup.
CODEXK8S_BOOTSTRAP_PLATFORM_ADMIN_EMAILS=""
CODEXK8S_GITHUB_OAUTH_CLIENT_ID=""
CODEXK8S_GITHUB_OAUTH_CLIENT_SECRET=""
# Optional: if empty, bootstrap generates a random value.
CODEXK8S_JWT_SIGNING_KEY=""
CODEXK8S_MCP_TOKEN_SIGNING_KEY=""
# Short-lived JWT TTL (e.g. 15m, 30m). Stored in runtime secret as plain text.
CODEXK8S_JWT_TTL="15m"
CODEXK8S_MCP_TOKEN_TTL="24h"
CODEXK8S_RUN_AGENT_LOGS_RETENTION_DAYS="14"
# Optional: if empty, bootstrap generates a random value.
# Used for validating GitHub webhook signatures (X-Hub-Signature-256).
CODEXK8S_GITHUB_WEBHOOK_SECRET=""
# Optional override for repository webhook endpoint.
CODEXK8S_GITHUB_WEBHOOK_URL=""
# Comma-separated GitHub webhook events.
CODEXK8S_GITHUB_WEBHOOK_EVENTS="push,pull_request,issues,issue_comment,pull_request_review,pull_request_review_comment"

# Canonical label catalog (GitHub repository variables, labels-as-vars).
# Active in S2: RUN_DEV_LABEL, RUN_DEV_REVISE_LABEL, RUN_DEBUG_LABEL.
RUN_INTAKE_LABEL="run:intake"
RUN_INTAKE_REVISE_LABEL="run:intake:revise"
RUN_VISION_LABEL="run:vision"
RUN_VISION_REVISE_LABEL="run:vision:revise"
RUN_PRD_LABEL="run:prd"
RUN_PRD_REVISE_LABEL="run:prd:revise"
RUN_ARCH_LABEL="run:arch"
RUN_ARCH_REVISE_LABEL="run:arch:revise"
RUN_DESIGN_LABEL="run:design"
RUN_DESIGN_REVISE_LABEL="run:design:revise"
RUN_PLAN_LABEL="run:plan"
RUN_PLAN_REVISE_LABEL="run:plan:revise"
RUN_DEV_LABEL="run:dev"
RUN_DEV_REVISE_LABEL="run:dev:revise"
RUN_DEBUG_LABEL="run:debug"
RUN_DOC_AUDIT_LABEL="run:doc-audit"
RUN_QA_LABEL="run:qa"
RUN_RELEASE_LABEL="run:release"
RUN_POSTDEPLOY_LABEL="run:postdeploy"
RUN_OPS_LABEL="run:ops"
RUN_ABORT_LABEL="run:abort"
RUN_RETHINK_LABEL="run:rethink"
STATE_BLOCKED_LABEL="state:blocked"
STATE_IN_REVIEW_LABEL="state:in-review"
STATE_APPROVED_LABEL="state:approved"
STATE_SUPERSEDED_LABEL="state:superseded"
STATE_ABANDONED_LABEL="state:abandoned"
NEED_INPUT_LABEL="need:input"
NEED_PM_LABEL="need:pm"
NEED_SA_LABEL="need:sa"
NEED_QA_LABEL="need:qa"
NEED_SRE_LABEL="need:sre"

# Configuration labels (model/reasoning profile for run:dev and run:dev:revise).
AI_MODEL_GPT_5_3_CODEX_LABEL="[ai-model-gpt-5.3-codex]"
AI_MODEL_GPT_5_3_CODEX_SPARK_LABEL="[ai-model-gpt-5.3-codex-spark]"
AI_MODEL_GPT_5_2_CODEX_LABEL="[ai-model-gpt-5.2-codex]"
AI_MODEL_GPT_5_1_CODEX_MAX_LABEL="[ai-model-gpt-5.1-codex-max]"
AI_MODEL_GPT_5_2_LABEL="[ai-model-gpt-5.2]"
AI_MODEL_GPT_5_1_CODEX_MINI_LABEL="[ai-model-gpt-5.1-codex-mini]"
AI_REASONING_LOW_LABEL="[ai-reasoning-low]"
AI_REASONING_MEDIUM_LABEL="[ai-reasoning-medium]"
AI_REASONING_HIGH_LABEL="[ai-reasoning-high]"
AI_REASONING_EXTRA_HIGH_LABEL="[ai-reasoning-extra-high]"

# Staging settings
CODEXK8S_STAGING_NAMESPACE="codex-k8s-ai-staging"
# Required: must resolve to TARGET_HOST before bootstrap starts.
CODEXK8S_STAGING_DOMAIN="staging.example.com"
# Required for Let's Encrypt account registration.
CODEXK8S_LETSENCRYPT_EMAIL="ops@example.com"
CODEXK8S_LETSENCRYPT_SERVER="https://acme-v02.api.letsencrypt.org/directory"

# Internal registry (no auth by design for MVP).
# Security model for staging: registry listens on node loopback (127.0.0.1) only.
# This profile is intended for single-node staging.
CODEXK8S_INTERNAL_REGISTRY_SERVICE="codex-k8s-registry"
CODEXK8S_INTERNAL_REGISTRY_PORT="5000"
CODEXK8S_INTERNAL_REGISTRY_STORAGE_SIZE="20Gi"
CODEXK8S_INTERNAL_REGISTRY_HOST="127.0.0.1:5000"
CODEXK8S_API_GATEWAY_INTERNAL_IMAGE_REPOSITORY="codex-k8s/api-gateway"
CODEXK8S_CONTROL_PLANE_INTERNAL_IMAGE_REPOSITORY="codex-k8s/control-plane"
CODEXK8S_WORKER_INTERNAL_IMAGE_REPOSITORY="codex-k8s/worker"
CODEXK8S_AGENT_RUNNER_INTERNAL_IMAGE_REPOSITORY="codex-k8s/agent-runner"
CODEXK8S_WEB_CONSOLE_INTERNAL_IMAGE_REPOSITORY="codex-k8s/web-console"
# Keep empty to let bootstrap autogenerate from CODEXK8S_INTERNAL_REGISTRY_HOST + per-service repositories.
CODEXK8S_API_GATEWAY_IMAGE=""
CODEXK8S_CONTROL_PLANE_IMAGE=""
CODEXK8S_WORKER_IMAGE=""
CODEXK8S_AGENT_RUNNER_IMAGE=""
CODEXK8S_WEB_CONSOLE_IMAGE=""
CODEXK8S_KANIKO_TIMEOUT="1800s"
CODEXK8S_KANIKO_CACHE_ENABLED="true"
# Optional: if empty, build script uses "${CODEXK8S_INTERNAL_REGISTRY_HOST}/codex-k8s/kaniko-cache".
CODEXK8S_KANIKO_CACHE_REPO=""
CODEXK8S_KANIKO_CACHE_TTL="168h"
CODEXK8S_KANIKO_CACHE_COMPRESSED="false"
CODEXK8S_KANIKO_MATRIX_MAX_PARALLEL="4"

# Kubernetes resources for platform services.
# Defaults in scripts remain small (100m-1 CPU / 256Mi-1Gi). For powerful staging host set higher values.
# Suggested high profile:
# - request: CPU 8, memory 16Gi
# - limit: CPU 16, memory 32Gi
CODEXK8S_API_GATEWAY_RESOURCES_REQUEST_CPU="100m"
CODEXK8S_API_GATEWAY_RESOURCES_REQUEST_MEMORY="256Mi"
CODEXK8S_API_GATEWAY_RESOURCES_LIMIT_CPU="1000m"
CODEXK8S_API_GATEWAY_RESOURCES_LIMIT_MEMORY="1Gi"
CODEXK8S_CONTROL_PLANE_RESOURCES_REQUEST_CPU="100m"
CODEXK8S_CONTROL_PLANE_RESOURCES_REQUEST_MEMORY="256Mi"
CODEXK8S_CONTROL_PLANE_RESOURCES_LIMIT_CPU="1000m"
CODEXK8S_CONTROL_PLANE_RESOURCES_LIMIT_MEMORY="1Gi"
CODEXK8S_WORKER_RESOURCES_REQUEST_CPU="100m"
CODEXK8S_WORKER_RESOURCES_REQUEST_MEMORY="256Mi"
CODEXK8S_WORKER_RESOURCES_LIMIT_CPU="1000m"
CODEXK8S_WORKER_RESOURCES_LIMIT_MEMORY="1Gi"
CODEXK8S_WEB_CONSOLE_RESOURCES_REQUEST_CPU="100m"
CODEXK8S_WEB_CONSOLE_RESOURCES_REQUEST_MEMORY="128Mi"
CODEXK8S_WEB_CONSOLE_RESOURCES_LIMIT_CPU="500m"
CODEXK8S_WEB_CONSOLE_RESOURCES_LIMIT_MEMORY="512Mi"

# Resources for Kaniko build jobs.
CODEXK8S_KANIKO_RESOURCES_REQUEST_CPU="1"
CODEXK8S_KANIKO_RESOURCES_REQUEST_MEMORY="1Gi"
CODEXK8S_KANIKO_RESOURCES_LIMIT_CPU="2"
CODEXK8S_KANIKO_RESOURCES_LIMIT_MEMORY="4Gi"

# Worker defaults (run loop + slots + Kubernetes jobs).
CODEXK8S_WORKER_REPLICAS="1"
CODEXK8S_WORKER_POLL_INTERVAL="5s"
CODEXK8S_WORKER_CLAIM_LIMIT="2"
CODEXK8S_WORKER_RUNNING_CHECK_LIMIT="200"
CODEXK8S_WORKER_SLOTS_PER_PROJECT="2"
CODEXK8S_WORKER_SLOT_LEASE_TTL="10m"
CODEXK8S_WORKER_K8S_NAMESPACE="codex-k8s-ai-staging"
CODEXK8S_WORKER_JOB_IMAGE=""
CODEXK8S_WORKER_JOB_COMMAND="/usr/local/bin/codex-k8s-agent-runner"
CODEXK8S_WORKER_JOB_TTL_SECONDS="600"
CODEXK8S_WORKER_JOB_BACKOFF_LIMIT="0"
CODEXK8S_WORKER_JOB_ACTIVE_DEADLINE_SECONDS="900"
CODEXK8S_WORKER_RUN_NAMESPACE_PREFIX="codex-issue"
CODEXK8S_WORKER_RUN_NAMESPACE_CLEANUP="true"
CODEXK8S_WORKER_RUN_SERVICE_ACCOUNT="codex-runner"
CODEXK8S_WORKER_RUN_ROLE_NAME="codex-runner"
CODEXK8S_WORKER_RUN_ROLE_BINDING_NAME="codex-runner"
CODEXK8S_WORKER_RUN_RESOURCE_QUOTA_NAME="codex-run-quota"
CODEXK8S_WORKER_RUN_LIMIT_RANGE_NAME="codex-run-limits"
CODEXK8S_WORKER_RUN_CREDENTIALS_SECRET_NAME="codex-run-credentials"
CODEXK8S_WORKER_RUN_QUOTA_PODS="20"
CODEXK8S_WORKER_RUN_QUOTA_REQUESTS_CPU="6"
CODEXK8S_WORKER_RUN_QUOTA_REQUESTS_MEMORY="24Gi"
CODEXK8S_WORKER_RUN_QUOTA_LIMITS_CPU="8"
CODEXK8S_WORKER_RUN_QUOTA_LIMITS_MEMORY="32Gi"
CODEXK8S_WORKER_RUN_LIMIT_DEFAULT_REQUEST_CPU="4"
CODEXK8S_WORKER_RUN_LIMIT_DEFAULT_REQUEST_MEMORY="16Gi"
CODEXK8S_WORKER_RUN_LIMIT_DEFAULT_CPU="6"
CODEXK8S_WORKER_RUN_LIMIT_DEFAULT_MEMORY="24Gi"
# Default model policy:
# - with CODEXK8S_OPENAI_AUTH_FILE => gpt-5.3-codex;
# - without it => runtime fallback to gpt-5.2-codex.
CODEXK8S_AGENT_DEFAULT_MODEL="gpt-5.3-codex"
CODEXK8S_AGENT_DEFAULT_REASONING_EFFORT="high"
CODEXK8S_AGENT_DEFAULT_LOCALE="ru"
CODEXK8S_AGENT_BASE_BRANCH="main"
CODEXK8S_CONTROL_PLANE_GRPC_TARGET="codex-k8s-control-plane.codex-k8s-ai-staging.svc.cluster.local:9090"
CODEXK8S_CONTROL_PLANE_MCP_BASE_URL="http://codex-k8s-control-plane.codex-k8s-ai-staging.svc.cluster.local:8081/mcp"

# Learning mode default for newly created projects.
# Keep "true" to enable educational explanations by default.
# Set empty value to disable by default.
CODEXK8S_LEARNING_MODE_DEFAULT="true"

# Runner/ARC
CODEXK8S_ENABLE_GITHUB_RUNNER="true"
CODEXK8S_RUNNER_MIN="1"
CODEXK8S_RUNNER_MAX="2"
CODEXK8S_RUNNER_NAMESPACE="actions-runner-staging"
CODEXK8S_RUNNER_SCALE_SET_NAME="codex-k8s-ai-staging"
CODEXK8S_RUNNER_IMAGE="ghcr.io/actions/actions-runner:latest"
CODEXK8S_WAIT_ROLLOUT="true"

# Timeouts and retries for slower servers/networks.
CODEXK8S_DNS_WAIT_TIMEOUT="900"
CODEXK8S_DNS_WAIT_INTERVAL="10"
CODEXK8S_NODE_DISCOVERY_TIMEOUT="300"
CODEXK8S_NODE_READY_TIMEOUT="1200s"
CODEXK8S_INGRESS_READY_TIMEOUT="1200s"
CODEXK8S_CERT_MANAGER_READY_TIMEOUT="1200s"
CODEXK8S_HELM_TIMEOUT="20m"
CODEXK8S_ROLLOUT_TIMEOUT="1800s"

# Optional storage profile for bootstrap.
# For staging/single-node k3s, PVC works without Longhorn via the default local-path provisioner.
CODEXK8S_INSTALL_LONGHORN="false"
# For bare-metal/staging without cloud LoadBalancer expose ingress directly on host :80/:443.
CODEXK8S_INGRESS_HOST_NETWORK="true"

# Host firewall hardening (recommended).
# When enabled, external inbound access is limited to CODEXK8S_SSH_PORT, 80 and 443.
CODEXK8S_FIREWALL_ENABLED="true"
# Keep equal to TARGET_PORT unless you intentionally expose SSH on another port.
CODEXK8S_SSH_PORT="22"

# NetworkPolicy baseline in Kubernetes (recommended).
# Labels platform/system namespaces and applies baseline restrictions for platform traffic.
CODEXK8S_NETWORK_POLICY_BASELINE="true"
# codex-k8s MCP HTTP port in platform namespace (used by project/agent policy template).
CODEXK8S_PLATFORM_MCP_PORT="8081"

# Allow egress to Kubernetes API server (k3s typically uses nodeIP:6443).
# For single-node staging set CODEXK8S_K8S_API_CIDR to the node IP /32.
# If empty, bootstrap will default to TARGET_HOST/32.
CODEXK8S_K8S_API_CIDR=""
CODEXK8S_K8S_API_PORT="6443"
