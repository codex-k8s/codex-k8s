openapi: 3.0.3
info:
  title: codex-k8s api-gateway
  version: 0.2.0
  description: |
    External webhook + staff API contract for codex-k8s.
servers:
  - url: https://platform.codex-k8s.dev
paths:
  /api/v1/webhooks/github:
    post:
      summary: Ingest GitHub webhook delivery
      operationId: ingestGithubWebhook
      tags: [webhooks]
      parameters:
        - in: header
          name: X-GitHub-Event
          required: true
          schema:
            type: string
        - in: header
          name: X-GitHub-Delivery
          required: true
          schema:
            type: string
        - in: header
          name: X-Hub-Signature-256
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        "202":
          description: Accepted and enqueued for processing
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IngestGitHubWebhookResponse"
        "200":
          description: Duplicate delivery already ingested
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/IngestGitHubWebhookResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/Internal"

  /api/v1/mcp/approver/callback:
    post:
      summary: Resolve one MCP approval request from external approver callback
      operationId: mcpApproverCallback
      tags: [mcp-callbacks]
      parameters:
        - $ref: "#/components/parameters/MCPCallbackToken"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MCPApprovalCallbackRequest"
      responses:
        "200":
          description: Approval callback applied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResolveApprovalDecisionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/Internal"

  /api/v1/mcp/executor/callback:
    post:
      summary: Resolve one MCP approval request from external executor callback
      operationId: mcpExecutorCallback
      tags: [mcp-callbacks]
      parameters:
        - $ref: "#/components/parameters/MCPCallbackToken"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MCPApprovalCallbackRequest"
      responses:
        "200":
          description: Executor callback applied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResolveApprovalDecisionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/Internal"

  /api/v1/auth/github/login:
    get:
      summary: Start GitHub OAuth login
      operationId: loginGithub
      tags: [auth]
      responses:
        "302":
          description: Redirect to GitHub OAuth authorize URL
        "500":
          $ref: "#/components/responses/Internal"

  /api/v1/auth/github/callback:
    get:
      summary: Complete GitHub OAuth callback and set auth cookie
      operationId: callbackGithub
      tags: [auth]
      parameters:
        - in: query
          name: state
          required: true
          schema:
            type: string
        - in: query
          name: code
          required: true
          schema:
            type: string
      responses:
        "302":
          description: Redirect to staff UI after successful login
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "500":
          $ref: "#/components/responses/Internal"

  /api/v1/auth/logout:
    post:
      summary: Logout current staff user
      operationId: logout
      tags: [auth]
      responses:
        "204":
          description: Logged out
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/auth/me:
    get:
      summary: Get current authenticated staff principal
      operationId: getMe
      tags: [auth]
      responses:
        "200":
          description: Authenticated principal
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MeResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/staff/projects:
    get:
      summary: List projects
      operationId: listProjects
      tags: [staff-projects]
      parameters:
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Project list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      summary: Create or update a project by slug
      operationId: upsertProject
      tags: [staff-projects]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertProjectRequest"
      responses:
        "201":
          description: Project created or updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/Internal"

  /api/v1/staff/projects/{project_id}:
    get:
      summary: Get project by id
      operationId: getProject
      tags: [staff-projects]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      responses:
        "200":
          description: Project
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Project"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      summary: Delete project by id
      operationId: deleteProject
      tags: [staff-projects]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      responses:
        "204":
          description: Project deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/runs:
    get:
      summary: List runs
      operationId: listRuns
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Runs list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/staff/runs/jobs:
    get:
      summary: List running jobs
      operationId: listRunJobs
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/TriggerKindFilter"
        - $ref: "#/components/parameters/RunStatusFilter"
        - $ref: "#/components/parameters/AgentKeyFilter"
      responses:
        "200":
          description: Running jobs list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/staff/runs/waits:
    get:
      summary: List wait queue runs
      operationId: listRunWaits
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/TriggerKindFilter"
        - $ref: "#/components/parameters/RunStatusFilter"
        - $ref: "#/components/parameters/AgentKeyFilter"
        - $ref: "#/components/parameters/WaitStateFilter"
      responses:
        "200":
          description: Wait queue list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/staff/approvals:
    get:
      summary: List pending approval requests
      operationId: listPendingApprovals
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Pending approvals list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApprovalRequestItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/approvals/{approval_request_id}/decision:
    post:
      summary: Resolve one approval request (approve/deny/expire/fail)
      operationId: resolveApprovalDecision
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/ApprovalRequestID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResolveApprovalDecisionRequest"
      responses:
        "200":
          description: Approval resolved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResolveApprovalDecisionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/staff/runs/{run_id}:
    get:
      summary: Get run by id
      operationId: getRun
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/RunID"
      responses:
        "200":
          description: Run details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Run"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/staff/runs/{run_id}/namespace:
    delete:
      summary: Force delete run namespace
      operationId: deleteRunNamespace
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/RunID"
      responses:
        "200":
          description: Namespace cleanup result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunNamespaceCleanupResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/runs/{run_id}/events:
    get:
      summary: List run flow events
      operationId: listRunEvents
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/RunID"
        - $ref: "#/components/parameters/Limit"
        - $ref: "#/components/parameters/IncludePayload"
      responses:
        "200":
          description: Flow events list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FlowEventItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/staff/runs/{run_id}/logs:
    get:
      summary: Get run logs snapshot with tail lines
      operationId: getRunLogs
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/RunID"
        - $ref: "#/components/parameters/TailLines"
        - $ref: "#/components/parameters/IncludeSnapshot"
      responses:
        "200":
          description: Run logs snapshot
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunLogs"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/staff/runs/{run_id}/learning-feedback:
    get:
      summary: List run learning feedback
      operationId: listRunLearningFeedback
      tags: [staff-runs]
      parameters:
        - $ref: "#/components/parameters/RunID"
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Learning feedback list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LearningFeedbackItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/v1/staff/runtime-deploy/tasks:
    get:
      summary: List runtime deploy tasks
      operationId: listRuntimeDeployTasks
      tags: [staff-runtime-deploy]
      parameters:
        - $ref: "#/components/parameters/Limit"
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, running, succeeded, failed]
        - in: query
          name: target_env
          schema:
            type: string
      responses:
        "200":
          description: Runtime deploy tasks list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeDeployTaskItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/runtime-deploy/tasks/{run_id}:
    get:
      summary: Get runtime deploy task details
      operationId: getRuntimeDeployTask
      tags: [staff-runtime-deploy]
      parameters:
        - $ref: "#/components/parameters/RunID"
      responses:
        "200":
          description: Runtime deploy task details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeDeployTask"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/staff/runtime-errors:
    get:
      summary: List runtime error journal entries
      operationId: listRuntimeErrors
      tags: [staff-runtime-deploy]
      parameters:
        - $ref: "#/components/parameters/Limit"
        - in: query
          name: state
          schema:
            type: string
            enum: [active, viewed, all]
        - in: query
          name: level
          schema:
            type: string
            enum: [error, warning, critical]
        - in: query
          name: source
          schema:
            type: string
        - in: query
          name: run_id
          schema:
            type: string
        - in: query
          name: correlation_id
          schema:
            type: string
      responses:
        "200":
          description: Runtime error journal entries
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeErrorItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/runtime-errors/{runtime_error_id}/viewed:
    post:
      summary: Mark runtime error as viewed
      operationId: markRuntimeErrorViewed
      tags: [staff-runtime-deploy]
      parameters:
        - $ref: "#/components/parameters/RuntimeErrorID"
      responses:
        "200":
          description: Runtime error marked as viewed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RuntimeError"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/staff/runtime-deploy/images:
    get:
      summary: List internal registry images
      operationId: listRegistryImages
      tags: [staff-runtime-deploy]
      parameters:
        - in: query
          name: repository
          schema:
            type: string
        - in: query
          name: limit_repositories
          schema:
            type: integer
            format: int32
        - in: query
          name: limit_tags
          schema:
            type: integer
            format: int32
      responses:
        "200":
          description: Registry image repositories list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistryImageRepositoryItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    delete:
      summary: Delete one internal registry image tag
      operationId: deleteRegistryImageTag
      tags: [staff-runtime-deploy]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DeleteRegistryImageTagRequest"
      responses:
        "200":
          description: Registry image tag delete result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegistryImageDeleteResult"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/runtime-deploy/images/cleanup:
    post:
      summary: Cleanup stale internal registry image tags
      operationId: cleanupRegistryImages
      tags: [staff-runtime-deploy]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CleanupRegistryImagesRequest"
      responses:
        "200":
          description: Registry cleanup execution result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CleanupRegistryImagesResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/users:
    get:
      summary: List users
      operationId: listUsers
      tags: [staff-users]
      parameters:
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Users list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      summary: Create allowed user
      operationId: createUser
      tags: [staff-users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "201":
          description: User created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/users/{user_id}:
    delete:
      summary: Delete user
      operationId: deleteUser
      tags: [staff-users]
      parameters:
        - $ref: "#/components/parameters/UserID"
      responses:
        "204":
          description: User deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/members:
    get:
      summary: List project members
      operationId: listProjectMembers
      tags: [staff-project-members]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Project members list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMemberItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      summary: Add or update project member
      operationId: upsertProjectMember
      tags: [staff-project-members]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertProjectMemberRequest"
      responses:
        "204":
          description: Member upserted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/members/{user_id}:
    delete:
      summary: Delete project member
      operationId: deleteProjectMember
      tags: [staff-project-members]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - $ref: "#/components/parameters/UserID"
      responses:
        "204":
          description: Member deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/members/{user_id}/learning-mode:
    put:
      summary: Set project member learning mode override
      operationId: setProjectMemberLearningModeOverride
      tags: [staff-project-members]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - $ref: "#/components/parameters/UserID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetProjectMemberLearningModeRequest"
      responses:
        "204":
          description: Learning mode override updated
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/repositories:
    get:
      summary: List project repositories
      operationId: listProjectRepositories
      tags: [staff-project-repositories]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Project repositories list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RepositoryBindingItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
    post:
      summary: Add or update project repository binding
      operationId: upsertProjectRepository
      tags: [staff-project-repositories]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertProjectRepositoryRequest"
      responses:
        "201":
          description: Repository binding created or updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RepositoryBinding"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/repositories/{repository_id}:
    delete:
      summary: Delete project repository binding
      operationId: deleteProjectRepository
      tags: [staff-project-repositories]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - in: path
          name: repository_id
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Repository binding deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/repositories/{repository_id}/bot-params:
    put:
      summary: Update repository bot parameters (token/login/email)
      operationId: upsertRepositoryBotParams
      tags: [staff-project-repositories]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - in: path
          name: repository_id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertRepositoryBotParamsRequest"
      responses:
        "204":
          description: Repository bot params updated
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/repositories/{repository_id}/preflight:
    post:
      summary: Run repository onboarding preflight
      operationId: runRepositoryPreflight
      tags: [staff-project-repositories]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
        - in: path
          name: repository_id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Preflight report
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RunRepositoryPreflightResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/github-tokens:
    get:
      summary: Get project-scoped GitHub tokens status
      operationId: getProjectGitHubTokens
      tags: [staff-projects]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      responses:
        "200":
          description: Project GitHub tokens
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectGitHubTokens"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    put:
      summary: Upsert project-scoped GitHub tokens
      operationId: upsertProjectGitHubTokens
      tags: [staff-projects]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertProjectGitHubTokensRequest"
      responses:
        "204":
          description: Project GitHub tokens updated
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/config-entries:
    get:
      summary: List configuration entries
      operationId: listConfigEntries
      tags: [staff-config]
      parameters:
        - in: query
          name: scope
          required: true
          schema:
            type: string
            enum: [platform, project, repository]
        - in: query
          name: project_id
          required: false
          schema:
            type: string
        - in: query
          name: repository_id
          required: false
          schema:
            type: string
        - $ref: "#/components/parameters/Limit"
      responses:
        "200":
          description: Config entries list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConfigEntryItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    post:
      summary: Upsert configuration entry
      operationId: upsertConfigEntry
      tags: [staff-config]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpsertConfigEntryRequest"
      responses:
        "201":
          description: Config entry upserted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConfigEntry"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/config-entries/{config_entry_id}:
    delete:
      summary: Delete configuration entry
      operationId: deleteConfigEntry
      tags: [staff-config]
      parameters:
        - in: path
          name: config_entry_id
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Config entry deleted
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/docset/groups:
    get:
      summary: List docset groups (manifest v1)
      operationId: listDocsetGroups
      tags: [staff-docset]
      parameters:
        - in: query
          name: docset_ref
          required: false
          schema:
            type: string
        - in: query
          name: locale
          required: false
          schema:
            type: string
            enum: [ru, en]
      responses:
        "200":
          description: Docset groups
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DocsetGroupItemsResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/docset/import:
    post:
      summary: Import docset into project repository (PR-based)
      operationId: importDocset
      tags: [staff-docset]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ImportDocsetRequest"
      responses:
        "200":
          description: Import created PR
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ImportDocsetResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/v1/staff/projects/{project_id}/docset/sync:
    post:
      summary: Safe sync docset into project repository (PR-based)
      operationId: syncDocset
      tags: [staff-docset]
      parameters:
        - $ref: "#/components/parameters/ProjectID"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SyncDocsetRequest"
      responses:
        "200":
          description: Sync created PR
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SyncDocsetResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

components:
  parameters:
    ProjectID:
      in: path
      name: project_id
      required: true
      schema:
        type: string
    RunID:
      in: path
      name: run_id
      required: true
      schema:
        type: string
    RuntimeErrorID:
      in: path
      name: runtime_error_id
      required: true
      schema:
        type: string
    ApprovalRequestID:
      in: path
      name: approval_request_id
      required: true
      schema:
        type: integer
        format: int64
    UserID:
      in: path
      name: user_id
      required: true
      schema:
        type: string
    Limit:
      in: query
      name: limit
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 1000
    TriggerKindFilter:
      in: query
      name: trigger_kind
      required: false
      schema:
        type: string
    RunStatusFilter:
      in: query
      name: status
      required: false
      schema:
        type: string
    AgentKeyFilter:
      in: query
      name: agent_key
      required: false
      schema:
        type: string
    WaitStateFilter:
      in: query
      name: wait_state
      required: false
      schema:
        type: string
    TailLines:
      in: query
      name: tail_lines
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 2000
    IncludePayload:
      in: query
      name: include_payload
      required: false
      schema:
        type: boolean
        default: false
    IncludeSnapshot:
      in: query
      name: include_snapshot
      required: false
      schema:
        type: boolean
        default: false
    MCPCallbackToken:
      in: header
      name: X-Codex-MCP-Token
      required: false
      schema:
        type: string
  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    Internal:
      description: Internal error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    ErrorResponse:
      type: object
      additionalProperties: false
      required: [code, message]
      properties:
        code:
          type: string
          enum:
            - invalid_argument
            - unauthorized
            - forbidden
            - not_found
            - conflict
            - failed_precondition
            - resource_exhausted
            - deadline_exceeded
            - unavailable
            - canceled
            - internal
        message:
          type: string
        field:
          type: string

    IngestGitHubWebhookResponse:
      type: object
      additionalProperties: false
      required: [correlation_id, status, duplicate]
      properties:
        correlation_id:
          type: string
        run_id:
          type: string
        status:
          type: string
          enum: [accepted, duplicate, ignored]
        duplicate:
          type: boolean

    MeUser:
      type: object
      additionalProperties: false
      required: [id, email, github_login, is_platform_admin, is_platform_owner]
      properties:
        id:
          type: string
        email:
          type: string
        github_login:
          type: string
        is_platform_admin:
          type: boolean
        is_platform_owner:
          type: boolean

    MeResponse:
      type: object
      additionalProperties: false
      required: [user]
      properties:
        user:
          $ref: "#/components/schemas/MeUser"

    RunNamespaceCleanupResponse:
      type: object
      additionalProperties: false
      required: [run_id, namespace, deleted, already_deleted]
      properties:
        run_id:
          type: string
        namespace:
          type: string
        deleted:
          type: boolean
        already_deleted:
          type: boolean
        comment_url:
          type: string
          nullable: true

    Project:
      type: object
      additionalProperties: false
      required: [id, slug, name, role]
      properties:
        id:
          type: string
        slug:
          type: string
        name:
          type: string
        role:
          type: string

    Run:
      type: object
      additionalProperties: false
      required:
        - id
        - correlation_id
        - project_slug
        - project_name
        - status
        - created_at
      properties:
        id:
          type: string
        correlation_id:
          type: string
        project_id:
          type: string
          nullable: true
        project_slug:
          type: string
        project_name:
          type: string
        issue_number:
          type: integer
          format: int32
          nullable: true
        issue_url:
          type: string
          nullable: true
        pr_number:
          type: integer
          format: int32
          nullable: true
        pr_url:
          type: string
          nullable: true
        trigger_kind:
          type: string
          nullable: true
        trigger_label:
          type: string
          nullable: true
        job_name:
          type: string
          nullable: true
        job_namespace:
          type: string
          nullable: true
        namespace:
          type: string
          nullable: true
        job_exists:
          type: boolean
        namespace_exists:
          type: boolean
        wait_state:
          type: string
          nullable: true
        wait_reason:
          type: string
          nullable: true
        agent_key:
          type: string
          nullable: true
        wait_since:
          type: string
          format: date-time
          nullable: true
        last_heartbeat_at:
          type: string
          format: date-time
          nullable: true
        status:
          type: string
        created_at:
          type: string
          format: date-time
        started_at:
          type: string
          format: date-time
          nullable: true
        finished_at:
          type: string
          format: date-time
          nullable: true

    ApprovalRequest:
      type: object
      additionalProperties: false
      required:
        - id
        - correlation_id
        - tool_name
        - action
        - approval_mode
        - requested_by
        - created_at
      properties:
        id:
          type: integer
          format: int64
        correlation_id:
          type: string
        run_id:
          type: string
          nullable: true
        project_id:
          type: string
          nullable: true
        project_slug:
          type: string
          nullable: true
        project_name:
          type: string
          nullable: true
        issue_number:
          type: integer
          format: int32
          nullable: true
        pr_number:
          type: integer
          format: int32
          nullable: true
        trigger_label:
          type: string
          nullable: true
        tool_name:
          type: string
        action:
          type: string
        approval_mode:
          type: string
          enum: [none, owner, delegated]
        requested_by:
          type: string
        created_at:
          type: string
          format: date-time

    ResolveApprovalDecisionRequest:
      type: object
      additionalProperties: false
      required: [decision]
      properties:
        decision:
          type: string
          enum: [approved, denied, expired, failed]
        reason:
          type: string
          nullable: true

    MCPApprovalCallbackRequest:
      type: object
      additionalProperties: false
      required: [approval_request_id, decision]
      properties:
        approval_request_id:
          type: integer
          format: int64
        decision:
          type: string
          enum: [approved, denied, expired, failed, applied]
        reason:
          type: string
          nullable: true
        actor_id:
          type: string
          nullable: true

    ResolveApprovalDecisionResponse:
      type: object
      additionalProperties: false
      required: [id, correlation_id, tool_name, action, approval_state]
      properties:
        id:
          type: integer
          format: int64
        correlation_id:
          type: string
        run_id:
          type: string
          nullable: true
        tool_name:
          type: string
        action:
          type: string
        approval_state:
          type: string
          enum: [requested, approved, denied, expired, failed, applied]

    FlowEvent:
      type: object
      additionalProperties: false
      required: [correlation_id, event_type, created_at, payload_json]
      properties:
        correlation_id:
          type: string
        event_type:
          type: string
        created_at:
          type: string
          format: date-time
        payload_json:
          type: string

    RunLogs:
      type: object
      additionalProperties: false
      required: [run_id, status, snapshot_json, tail_lines]
      properties:
        run_id:
          type: string
        status:
          type: string
        updated_at:
          type: string
          format: date-time
          nullable: true
        snapshot_json:
          type: string
        tail_lines:
          type: array
          items:
            type: string

    RuntimeDeployTaskLog:
      type: object
      additionalProperties: false
      required: [stage, level, message]
      properties:
        stage:
          type: string
        level:
          type: string
          enum: [info, warn, error]
        message:
          type: string
        created_at:
          type: string
          format: date-time
          nullable: true

    RuntimeDeployTaskListItem:
      type: object
      additionalProperties: false
      required: [run_id, status, repository_full_name, target_env, namespace, runtime_mode, build_ref]
      properties:
        run_id:
          type: string
        status:
          type: string
          enum: [pending, running, succeeded, failed]
        repository_full_name:
          type: string
        target_env:
          type: string
        result_target_env:
          type: string
          nullable: true
        namespace:
          type: string
        result_namespace:
          type: string
          nullable: true
        runtime_mode:
          type: string
        build_ref:
          type: string
        created_at:
          type: string
          format: date-time
          nullable: true
        updated_at:
          type: string
          format: date-time
          nullable: true

    RuntimeDeployTask:
      type: object
      additionalProperties: false
      required: [run_id, runtime_mode, namespace, target_env, slot_no, repository_full_name, services_yaml_path, build_ref, deploy_only, status, attempts, logs]
      properties:
        run_id:
          type: string
        runtime_mode:
          type: string
        namespace:
          type: string
        target_env:
          type: string
        slot_no:
          type: integer
          format: int32
        repository_full_name:
          type: string
        services_yaml_path:
          type: string
        build_ref:
          type: string
        deploy_only:
          type: boolean
        status:
          type: string
          enum: [pending, running, succeeded, failed]
        lease_owner:
          type: string
          nullable: true
        lease_until:
          type: string
          format: date-time
          nullable: true
        attempts:
          type: integer
          format: int32
        last_error:
          type: string
          nullable: true
        result_namespace:
          type: string
          nullable: true
        result_target_env:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
          nullable: true
        updated_at:
          type: string
          format: date-time
          nullable: true
        started_at:
          type: string
          format: date-time
          nullable: true
        finished_at:
          type: string
          format: date-time
          nullable: true
        logs:
          type: array
          items:
            $ref: "#/components/schemas/RuntimeDeployTaskLog"

    RuntimeError:
      type: object
      additionalProperties: false
      required: [id, source, level, message, details_json, created_at]
      properties:
        id:
          type: string
        source:
          type: string
        level:
          type: string
          enum: [error, warning, critical]
        message:
          type: string
        details_json:
          type: string
        stack_trace:
          type: string
          nullable: true
        correlation_id:
          type: string
          nullable: true
        run_id:
          type: string
          nullable: true
        project_id:
          type: string
          nullable: true
        namespace:
          type: string
          nullable: true
        job_name:
          type: string
          nullable: true
        viewed_at:
          type: string
          format: date-time
          nullable: true
        viewed_by:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    RegistryImageTag:
      type: object
      additionalProperties: false
      required: [tag, digest, config_size_bytes]
      properties:
        tag:
          type: string
        digest:
          type: string
        created_at:
          type: string
          format: date-time
          nullable: true
        config_size_bytes:
          type: integer
          format: int64

    RegistryImageRepository:
      type: object
      additionalProperties: false
      required: [repository, tag_count, tags]
      properties:
        repository:
          type: string
        tag_count:
          type: integer
          format: int32
        tags:
          type: array
          items:
            $ref: "#/components/schemas/RegistryImageTag"

    DeleteRegistryImageTagRequest:
      type: object
      additionalProperties: false
      required: [repository, tag]
      properties:
        repository:
          type: string
        tag:
          type: string

    RegistryImageDeleteResult:
      type: object
      additionalProperties: false
      required: [repository, tag, digest, deleted]
      properties:
        repository:
          type: string
        tag:
          type: string
        digest:
          type: string
        deleted:
          type: boolean

    CleanupRegistryImagesRequest:
      type: object
      additionalProperties: false
      required: [dry_run]
      properties:
        repository_prefix:
          type: string
        limit_repositories:
          type: integer
          format: int32
        keep_tags:
          type: integer
          format: int32
        dry_run:
          type: boolean

    CleanupRegistryImagesResponse:
      type: object
      additionalProperties: false
      required: [repositories_scanned, tags_deleted, tags_skipped, deleted, skipped]
      properties:
        repositories_scanned:
          type: integer
          format: int32
        tags_deleted:
          type: integer
          format: int32
        tags_skipped:
          type: integer
          format: int32
        deleted:
          type: array
          items:
            $ref: "#/components/schemas/RegistryImageDeleteResult"
        skipped:
          type: array
          items:
            $ref: "#/components/schemas/RegistryImageDeleteResult"

    LearningFeedback:
      type: object
      additionalProperties: false
      required: [id, run_id, kind, explanation, created_at]
      properties:
        id:
          type: integer
          format: int64
        run_id:
          type: string
        repository_id:
          type: string
          nullable: true
        pr_number:
          type: integer
          format: int32
          nullable: true
        file_path:
          type: string
          nullable: true
        line:
          type: integer
          format: int32
          nullable: true
        kind:
          type: string
        explanation:
          type: string
        created_at:
          type: string
          format: date-time

    User:
      type: object
      additionalProperties: false
      required: [id, email, is_platform_admin, is_platform_owner]
      properties:
        id:
          type: string
        email:
          type: string
        github_user_id:
          type: integer
          format: int64
          nullable: true
        github_login:
          type: string
          nullable: true
        is_platform_admin:
          type: boolean
        is_platform_owner:
          type: boolean

    ProjectMember:
      type: object
      additionalProperties: false
      required: [project_id, user_id, email, role]
      properties:
        project_id:
          type: string
        user_id:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [read, read_write, admin]
        learning_mode_override:
          type: boolean
          nullable: true

    RepositoryBinding:
      type: object
      additionalProperties: false
      required: [id, project_id, provider, external_id, owner, name, services_yaml_path]
      properties:
        id:
          type: string
        project_id:
          type: string
        provider:
          type: string
        external_id:
          type: integer
          format: int64
        owner:
          type: string
        name:
          type: string
        services_yaml_path:
          type: string
        bot_username:
          type: string
          nullable: true
        bot_email:
          type: string
          nullable: true
        preflight_updated_at:
          type: string
          nullable: true

    ProjectGitHubTokens:
      type: object
      additionalProperties: false
      required: [project_id, has_platform_token, has_bot_token]
      properties:
        project_id:
          type: string
        has_platform_token:
          type: boolean
        has_bot_token:
          type: boolean
        bot_username:
          type: string
          nullable: true
        bot_email:
          type: string
          nullable: true

    UpsertProjectGitHubTokensRequest:
      type: object
      additionalProperties: false
      properties:
        platform_token:
          type: string
          nullable: true
        bot_token:
          type: string
          nullable: true
        bot_username:
          type: string
          nullable: true
        bot_email:
          type: string
          nullable: true

    UpsertRepositoryBotParamsRequest:
      type: object
      additionalProperties: false
      properties:
        bot_token:
          type: string
          nullable: true
        bot_username:
          type: string
          nullable: true
        bot_email:
          type: string
          nullable: true

    PreflightCheckResult:
      type: object
      additionalProperties: false
      required: [name, status]
      properties:
        name:
          type: string
        status:
          type: string
        details:
          type: string
          nullable: true

    RunRepositoryPreflightResponse:
      type: object
      additionalProperties: false
      required: [repository_id, status, checks, report_json, finished_at]
      properties:
        repository_id:
          type: string
        status:
          type: string
        checks:
          type: array
          items:
            $ref: "#/components/schemas/PreflightCheckResult"
        report_json:
          type: string
        finished_at:
          type: string

    ConfigEntryMutability:
      type: string
      enum: [startup_required, runtime_mutable]

    ConfigEntry:
      type: object
      additionalProperties: false
      required: [id, scope, kind, key, sync_targets, mutability, is_dangerous]
      properties:
        id:
          type: string
        scope:
          type: string
          enum: [platform, project, repository]
        kind:
          type: string
          enum: [variable, secret]
        project_id:
          type: string
          nullable: true
        repository_id:
          type: string
          nullable: true
        key:
          type: string
        value:
          type: string
          nullable: true
        sync_targets:
          type: array
          items:
            type: string
        mutability:
          $ref: "#/components/schemas/ConfigEntryMutability"
        is_dangerous:
          type: boolean
        updated_at:
          type: string
          nullable: true

    ConfigEntryItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ConfigEntry"

    UpsertConfigEntryRequest:
      type: object
      additionalProperties: false
      required: [scope, kind, key]
      properties:
        scope:
          type: string
          enum: [platform, project, repository]
        kind:
          type: string
          enum: [variable, secret]
        project_id:
          type: string
          nullable: true
        repository_id:
          type: string
          nullable: true
        key:
          type: string
        value_plain:
          type: string
          nullable: true
        value_secret:
          type: string
          nullable: true
        sync_targets:
          type: array
          items:
            type: string
        mutability:
          $ref: "#/components/schemas/ConfigEntryMutability"
        is_dangerous:
          type: boolean
        dangerous_confirmed:
          type: boolean

    DocsetGroup:
      type: object
      additionalProperties: false
      required: [id, title, description, default_selected]
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        default_selected:
          type: boolean

    DocsetGroupItemsResponse:
      type: object
      additionalProperties: false
      required: [groups]
      properties:
        groups:
          type: array
          items:
            $ref: "#/components/schemas/DocsetGroup"

    ImportDocsetRequest:
      type: object
      additionalProperties: false
      required: [repository_id, docset_ref, locale, group_ids]
      properties:
        repository_id:
          type: string
        docset_ref:
          type: string
        locale:
          type: string
          enum: [ru, en]
        group_ids:
          type: array
          items:
            type: string

    ImportDocsetResponse:
      type: object
      additionalProperties: false
      required: [repository_full_name, pr_number, pr_url, branch, files_total]
      properties:
        repository_full_name:
          type: string
        pr_number:
          type: integer
        pr_url:
          type: string
        branch:
          type: string
        files_total:
          type: integer

    SyncDocsetRequest:
      type: object
      additionalProperties: false
      required: [repository_id, docset_ref]
      properties:
        repository_id:
          type: string
        docset_ref:
          type: string

    SyncDocsetResponse:
      type: object
      additionalProperties: false
      required: [repository_full_name, pr_number, pr_url, branch, files_updated, files_drift]
      properties:
        repository_full_name:
          type: string
        pr_number:
          type: integer
        pr_url:
          type: string
        branch:
          type: string
        files_updated:
          type: integer
        files_drift:
          type: integer

    ProjectItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Project"

    RunItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/Run"

    RuntimeDeployTaskItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RuntimeDeployTaskListItem"

    RuntimeErrorItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RuntimeError"

    RegistryImageRepositoryItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RegistryImageRepository"

    ApprovalRequestItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ApprovalRequest"

    FlowEventItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/FlowEvent"

    LearningFeedbackItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/LearningFeedback"

    UserItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/User"

    ProjectMemberItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProjectMember"

    RepositoryBindingItemsResponse:
      type: object
      additionalProperties: false
      required: [items]
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/RepositoryBinding"

    UpsertProjectRequest:
      type: object
      additionalProperties: false
      required: [slug, name]
      properties:
        slug:
          type: string
          minLength: 1
        name:
          type: string
          minLength: 1

    CreateUserRequest:
      type: object
      additionalProperties: false
      required: [email, is_platform_admin]
      properties:
        email:
          type: string
          format: email
        is_platform_admin:
          type: boolean

    UpsertProjectMemberRequest:
      type: object
      additionalProperties: false
      properties:
        user_id:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [read, read_write, admin]
      oneOf:
        - required: [user_id, role]
        - required: [email, role]

    SetProjectMemberLearningModeRequest:
      type: object
      additionalProperties: false
      required: [enabled]
      properties:
        enabled:
          type: boolean
          nullable: true

    UpsertProjectRepositoryRequest:
      type: object
      additionalProperties: false
      required: [provider, owner, name, token, services_yaml_path]
      properties:
        provider:
          type: string
          minLength: 1
        owner:
          type: string
          minLength: 1
        name:
          type: string
          minLength: 1
        token:
          type: string
          minLength: 1
        services_yaml_path:
          type: string
          minLength: 1
