{{- if eq .PromptLocale "ru" }}
Общий контекст окружения:
- Репозиторий: {{ .RepositoryFullName }}
- Run ID: {{ .RunID }}
- Номер issue: {{ .IssueNumber }}
- Ключ агента: {{ .AgentKey }}
- Целевая ветка: {{ .TargetBranch }}
- Базовая ветка: {{ .BaseBranch }}
- Тип запуска: {{ .TriggerKind }}
{{- if .HasExistingPR }}
- Текущий PR: #{{ .ExistingPRNumber }}
{{- end }}

Обязательные правила:
- Используйте MCP-инструменты для операций с issue/PR/comments/labels.
- Git-токен используйте только для git fetch/commit/push transport path.
{{- if eq .TriggerKind "dev" }}
- Запуск инициирован меткой `run:dev`: создайте или обновите PR в `{{ .BaseBranch }}`.
{{- else if eq .TriggerKind "dev_revise" }}
{{- if .HasExistingPR }}
- Запуск инициирован меткой `run:dev:revise`: обновляйте существующий PR #{{ .ExistingPRNumber }}.
{{- else }}
- Запуск инициирован меткой `run:dev:revise`: обновляйте только существующий PR.
{{- end }}
{{- end }}
- Работайте в ветке `{{ .TargetBranch }}`.
- Язык user-facing коммуникации: русский.
- На русском языке оформляйте ответы пользователю, тексты PR/Issue и комментарии.
- Верните ТОЛЬКО JSON-объект, соответствующий output schema.
{{- if .HasContext7 }}
- Через MCP доступен Context7: активно используйте его для актуальной документации библиотек и уточнения актуальных версий.
{{- end }}

Тело задачи:
{{ .TaskBody }}
{{- else }}
Environment context:
- Repository: {{ .RepositoryFullName }}
- Run ID: {{ .RunID }}
- Issue number: {{ .IssueNumber }}
- Agent key: {{ .AgentKey }}
- Target branch: {{ .TargetBranch }}
- Base branch: {{ .BaseBranch }}
- Trigger kind: {{ .TriggerKind }}
{{- if .HasExistingPR }}
- Existing PR: #{{ .ExistingPRNumber }}
{{- end }}

Mandatory rules:
- Use MCP tools for issue/PR/comment/label operations.
- Use Git token only for git fetch/commit/push transport path.
{{- if eq .TriggerKind "dev" }}
- This run was triggered by `run:dev`: create or update PR to `{{ .BaseBranch }}`.
{{- else if eq .TriggerKind "dev_revise" }}
{{- if .HasExistingPR }}
- This run was triggered by `run:dev:revise`: update existing PR #{{ .ExistingPRNumber }} only.
{{- else }}
- This run was triggered by `run:dev:revise`: update existing PR only.
{{- end }}
{{- end }}
- Keep branch `{{ .TargetBranch }}`.
- User-facing communication language: English.
- Write user responses, PR/Issue texts and comments in English.
- Return ONLY a JSON object matching the output schema.
{{- if .HasContext7 }}
- Context7 is available via MCP: use it proactively for up-to-date library docs and current stable versions.
{{- end }}

Task body:
{{ .TaskBody }}
{{- end }}
